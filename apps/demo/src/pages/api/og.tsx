import { ImageResponse } from '@vercel/og';
import { NextRequest } from 'next/server';

import { Inter } from 'next/font/google';
const inter = Inter({ subsets: ['latin'] });

export const config = {
	runtime: 'edge',
};

export default async function handler(request: NextRequest) {
	try {
		const fontData = await fetch(
			new URL('/public/assets/GeistMono.otf', import.meta.url)
		).then((res) => res.arrayBuffer());

		const background = await fetch(
			new URL('/public/assets/og-background.png', import.meta.url)
		).then((res) => res.arrayBuffer());

		const { searchParams } = new URL(request.url);
		const hasTitle = searchParams.has('title');
		const title = hasTitle
			? searchParams.get('title')?.slice(0, 100)
			: 'Atomic Toolkit';

		return new ImageResponse(
			(
				<div tw='w-full h-full relative flex flex-col justify-center items-center'>
					<img tw='absolute h-full w-full' src={background as unknown as string} />
					<div tw='flex flex-col justify-center items-center'>
						{hasTitle && (
							<h1 tw='text-5xl font-bold text-white font-Geist mb-8'>{title}</h1>
						)}
						<svg
							width='344'
							height='58'
							viewBox='0 0 344 58'
							fill='none'
							xmlns='http://www.w3.org/2000/svg'
						>
							<path
								d='M61.4041 46H52.3359L64.1143 11.0909H75.3473L87.1257 46H78.0575L69.8587 19.8864H69.5859L61.4041 46ZM60.1939 32.2614H79.1484V38.6705H60.1939V32.2614ZM104.022 19.8182V25.9545H87.505V19.8182H104.022ZM90.9652 13.5455H99.3004V37.767C99.3004 38.2784 99.38 38.6932 99.5391 39.0114C99.7095 39.3182 99.9538 39.5398 100.272 39.6761C100.59 39.8011 100.971 39.8636 101.414 39.8636C101.732 39.8636 102.067 39.8352 102.42 39.7784C102.783 39.7102 103.056 39.6534 103.238 39.608L104.499 45.625C104.102 45.7386 103.539 45.8807 102.812 46.0511C102.096 46.2216 101.238 46.3295 100.238 46.375C98.2834 46.4659 96.6072 46.2386 95.2095 45.6932C93.8232 45.1364 92.7607 44.2727 92.022 43.1023C91.2947 41.9318 90.9425 40.4602 90.9652 38.6875V13.5455ZM120.215 46.4943C117.465 46.4943 115.102 45.9318 113.124 44.8068C111.158 43.6705 109.641 42.0909 108.573 40.0682C107.516 38.0341 106.988 35.6761 106.988 32.9943C106.988 30.3011 107.516 27.9432 108.573 25.9205C109.641 23.8864 111.158 22.3068 113.124 21.1818C115.102 20.0455 117.465 19.4773 120.215 19.4773C122.965 19.4773 125.323 20.0455 127.289 21.1818C129.266 22.3068 130.783 23.8864 131.84 25.9205C132.908 27.9432 133.442 30.3011 133.442 32.9943C133.442 35.6761 132.908 38.0341 131.84 40.0682C130.783 42.0909 129.266 43.6705 127.289 44.8068C125.323 45.9318 122.965 46.4943 120.215 46.4943ZM120.266 40.2045C121.266 40.2045 122.113 39.8977 122.806 39.2841C123.499 38.6705 124.028 37.8182 124.391 36.7273C124.766 35.6364 124.954 34.375 124.954 32.9432C124.954 31.4886 124.766 30.2159 124.391 29.125C124.028 28.0341 123.499 27.1818 122.806 26.5682C122.113 25.9545 121.266 25.6477 120.266 25.6477C119.232 25.6477 118.357 25.9545 117.641 26.5682C116.937 27.1818 116.397 28.0341 116.022 29.125C115.658 30.2159 115.477 31.4886 115.477 32.9432C115.477 34.375 115.658 35.6364 116.022 36.7273C116.397 37.8182 116.937 38.6705 117.641 39.2841C118.357 39.8977 119.232 40.2045 120.266 40.2045ZM137.712 46V19.8182H145.638V24.625H145.928C146.474 23.0341 147.394 21.7784 148.69 20.858C149.985 19.9375 151.531 19.4773 153.326 19.4773C155.144 19.4773 156.701 19.9432 157.996 20.875C159.292 21.8068 160.116 23.0568 160.468 24.625H160.741C161.229 23.0682 162.184 21.8239 163.604 20.892C165.025 19.9489 166.701 19.4773 168.633 19.4773C171.11 19.4773 173.121 20.2727 174.667 21.8636C176.212 23.4432 176.985 25.6136 176.985 28.375V46H168.65V30.2841C168.65 28.9773 168.315 27.983 167.644 27.3011C166.974 26.608 166.104 26.2614 165.036 26.2614C163.888 26.2614 162.985 26.6364 162.326 27.3864C161.678 28.125 161.354 29.1193 161.354 30.3693V46H153.343V30.1989C153.343 28.983 153.013 28.0227 152.354 27.3182C151.695 26.6136 150.826 26.2614 149.746 26.2614C149.019 26.2614 148.377 26.4375 147.82 26.7898C147.263 27.1307 146.826 27.6193 146.508 28.2557C146.201 28.892 146.048 29.642 146.048 30.5057V46H137.712ZM182.15 46V19.8182H190.485V46H182.15ZM186.326 16.767C185.156 16.767 184.15 16.3807 183.309 15.608C182.468 14.8239 182.048 13.8807 182.048 12.7784C182.048 11.6875 182.468 10.7557 183.309 9.98295C184.15 9.19886 185.156 8.80682 186.326 8.80682C187.508 8.80682 188.513 9.19886 189.343 9.98295C190.184 10.7557 190.604 11.6875 190.604 12.7784C190.604 13.8807 190.184 14.8239 189.343 15.608C188.513 16.3807 187.508 16.767 186.326 16.767ZM208.012 46.4943C205.251 46.4943 202.881 45.9261 200.904 44.7898C198.938 43.6534 197.427 42.0739 196.37 40.0511C195.313 38.017 194.785 35.6648 194.785 32.9943C194.785 30.3125 195.313 27.9602 196.37 25.9375C197.438 23.9034 198.955 22.3182 200.921 21.1818C202.898 20.0455 205.256 19.4773 207.995 19.4773C210.415 19.4773 212.523 19.9148 214.319 20.7898C216.126 21.6648 217.535 22.9034 218.546 24.5057C219.569 26.0966 220.109 27.9659 220.165 30.1136H212.376C212.217 28.7727 211.762 27.7216 211.012 26.9602C210.273 26.1989 209.308 25.8182 208.114 25.8182C207.148 25.8182 206.302 26.0909 205.575 26.6364C204.847 27.1705 204.279 27.9659 203.87 29.0227C203.472 30.0682 203.273 31.3636 203.273 32.9091C203.273 34.4545 203.472 35.7614 203.87 36.8295C204.279 37.8864 204.847 38.6875 205.575 39.233C206.302 39.767 207.148 40.0341 208.114 40.0341C208.887 40.0341 209.569 39.8693 210.16 39.5398C210.762 39.2102 211.256 38.7273 211.643 38.0909C212.029 37.4432 212.273 36.6591 212.376 35.7386H220.165C220.086 37.8977 219.546 39.7841 218.546 41.3977C217.558 43.0114 216.165 44.267 214.37 45.1648C212.586 46.0511 210.467 46.4943 208.012 46.4943Z'
								fill='#E7EDFF'
							/>
							<path
								d='M226.72 21.3267V16.9091H249.93V21.3267H240.939V46H235.711V21.3267H226.72ZM258.53 46.4261C256.4 46.4261 254.553 45.9574 252.99 45.0199C251.428 44.0824 250.216 42.7708 249.354 41.0852C248.502 39.3996 248.076 37.4299 248.076 35.1761C248.076 32.9223 248.502 30.9479 249.354 29.2528C250.216 27.5578 251.428 26.2415 252.99 25.304C254.553 24.3665 256.4 23.8977 258.53 23.8977C260.661 23.8977 262.507 24.3665 264.07 25.304C265.632 26.2415 266.84 27.5578 267.692 29.2528C268.554 30.9479 268.985 32.9223 268.985 35.1761C268.985 37.4299 268.554 39.3996 267.692 41.0852C266.84 42.7708 265.632 44.0824 264.07 45.0199C262.507 45.9574 260.661 46.4261 258.53 46.4261ZM258.559 42.3068C259.714 42.3068 260.68 41.9896 261.456 41.3551C262.233 40.7112 262.81 39.8494 263.189 38.7699C263.578 37.6903 263.772 36.4877 263.772 35.1619C263.772 33.8267 263.578 32.6193 263.189 31.5398C262.81 30.4508 262.233 29.5843 261.456 28.9403C260.68 28.2964 259.714 27.9744 258.559 27.9744C257.375 27.9744 256.39 28.2964 255.604 28.9403C254.828 29.5843 254.245 30.4508 253.857 31.5398C253.478 32.6193 253.289 33.8267 253.289 35.1619C253.289 36.4877 253.478 37.6903 253.857 38.7699C254.245 39.8494 254.828 40.7112 255.604 41.3551C256.39 41.9896 257.375 42.3068 258.559 42.3068ZM280.866 46.4261C278.735 46.4261 276.889 45.9574 275.326 45.0199C273.764 44.0824 272.552 42.7708 271.69 41.0852C270.838 39.3996 270.412 37.4299 270.412 35.1761C270.412 32.9223 270.838 30.9479 271.69 29.2528C272.552 27.5578 273.764 26.2415 275.326 25.304C276.889 24.3665 278.735 23.8977 280.866 23.8977C282.997 23.8977 284.843 24.3665 286.406 25.304C287.968 26.2415 289.176 27.5578 290.028 29.2528C290.89 30.9479 291.321 32.9223 291.321 35.1761C291.321 37.4299 290.89 39.3996 290.028 41.0852C289.176 42.7708 287.968 44.0824 286.406 45.0199C284.843 45.9574 282.997 46.4261 280.866 46.4261ZM280.895 42.3068C282.05 42.3068 283.016 41.9896 283.792 41.3551C284.569 40.7112 285.146 39.8494 285.525 38.7699C285.913 37.6903 286.108 36.4877 286.108 35.1619C286.108 33.8267 285.913 32.6193 285.525 31.5398C285.146 30.4508 284.569 29.5843 283.792 28.9403C283.016 28.2964 282.05 27.9744 280.895 27.9744C279.711 27.9744 278.726 28.2964 277.94 28.9403C277.163 29.5843 276.581 30.4508 276.193 31.5398C275.814 32.6193 275.625 33.8267 275.625 35.1619C275.625 36.4877 275.814 37.6903 276.193 38.7699C276.581 39.8494 277.163 40.7112 277.94 41.3551C278.726 41.9896 279.711 42.3068 280.895 42.3068ZM298.827 16.9091V46H293.685V16.9091H298.827ZM306.802 39.1534L306.788 32.946H307.612L315.453 24.1818H321.461L311.816 34.9205H310.751L306.802 39.1534ZM302.115 46V16.9091H307.257V46H302.115ZM315.808 46L308.706 36.071L312.172 32.4489L321.958 46H315.808ZM322.888 46V24.1818H328.03V46H322.888ZM325.473 21.0852C324.659 21.0852 323.958 20.8153 323.371 20.2756C322.784 19.7263 322.49 19.0682 322.49 18.3011C322.49 17.5246 322.784 16.8665 323.371 16.3267C323.958 15.7775 324.659 15.5028 325.473 15.5028C326.297 15.5028 326.998 15.7775 327.576 16.3267C328.163 16.8665 328.456 17.5246 328.456 18.3011C328.456 19.0682 328.163 19.7263 327.576 20.2756C326.998 20.8153 326.297 21.0852 325.473 21.0852ZM342.213 24.1818V28.1591H329.67V24.1818H342.213ZM332.767 18.9545H337.909V39.4375C337.909 40.1288 338.013 40.6591 338.221 41.0284C338.439 41.3883 338.723 41.6345 339.074 41.767C339.424 41.8996 339.812 41.9659 340.238 41.9659C340.56 41.9659 340.854 41.9422 341.119 41.8949C341.394 41.8475 341.602 41.8049 341.744 41.767L342.61 45.7869C342.336 45.8816 341.943 45.9858 341.431 46.0994C340.93 46.2131 340.314 46.2794 339.585 46.2983C338.297 46.3362 337.137 46.142 336.105 45.7159C335.073 45.2803 334.253 44.608 333.647 43.6989C333.051 42.7898 332.757 41.6534 332.767 40.2898V18.9545Z'
								fill='#A8B6FF'
							/>
							<path
								d='M39.225 18.8031C42.5344 18.025 45 15.0531 45 11.5C45 7.35625 41.6438 4 37.5 4C33.4312 4 30.1219 7.23438 30 11.2656L12.7687 18.1656C11.4094 16.825 9.55312 16 7.5 16C3.35625 16 0 19.3562 0 23.5C0 27.6438 3.35625 31 7.5 31C8.64375 31 9.73125 30.7469 10.6969 30.2875L24.3469 42.2312C24.1219 42.9437 24 43.7125 24 44.5C24 48.6438 27.3562 52 31.5 52C35.6438 52 39 48.6438 39 44.5C39 41.9031 37.6875 39.6156 35.6813 38.275L39.225 18.8031ZM14.6531 25.7687C14.8594 25.1219 14.9812 24.4375 15 23.7344L32.2312 16.8438C32.5687 17.1719 32.925 17.4719 33.3187 17.7344L29.775 37.1969C29.2594 37.3188 28.7625 37.4875 28.2937 37.7125L14.6531 25.7687Z'
								fill='#4779FF'
							/>
						</svg>
					</div>
				</div>
			),
			{
				width: 1200,
				height: 630,
				fonts: [
					{
						name: 'Geist',
						data: fontData,
						style: 'normal',
					},
				],
			}
		);
	} catch (error) {
		console.error(error);
		return new Response('Something went wrong!', { status: 500 });
	}
}
